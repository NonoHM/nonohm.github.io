<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> THM Windows Forensics 1 | NonoHM </title> <meta name="author" content="NonoHM "> <meta name="description" content="Welcome to my personnal website. I am currently a 2nd year student in the " but r et t program. i like doing sports and music besides learning new things in it.> <meta name="keywords" content="jekyll, jekyll-theme, portfolio-website, writeups, projects"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nonohm.github.io/blog/2024/THM-Windows-Forensics-1/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> NonoHM </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">THM Windows Forensics 1</h1> <p class="post-meta"> December 17, 2024 • NonoHM </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/thm"> <i class="fa-solid fa-hashtag fa-sm"></i> THM</a>   <a href="/blog/tag/digital-forensics"> <i class="fa-solid fa-hashtag fa-sm"></i> Digital Forensics</a>   <a href="/blog/tag/incident-response"> <i class="fa-solid fa-hashtag fa-sm"></i> Incident Response</a>   <a href="/blog/tag/windows"> <i class="fa-solid fa-hashtag fa-sm"></i> Windows</a>   <a href="/blog/tag/windows-forensics"> <i class="fa-solid fa-hashtag fa-sm"></i> Windows Forensics</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="task-1---introduction-to-windows">Task 1 - Introduction to Windows</h2> <p>Computer forensics is an essential field of cyber security that involves gathering evidence of activities performed on a computer. It is a part of the wider field, <em>Digital Forensics</em>, which deals with all types of digital devices, including recovering, examining and analyzing data found in digital devices. Applications of <em>Digital Forensics</em> are detailed in the <a href="https://tryhackme.com/r/room/introductoryroomdfirmodule" rel="external nofollow noopener" target="_blank">Introductory room</a>.</p> <p>Because Windows is the most used Operating System right now and holds roughly 80% of the desktop market share, it is important to know how to perform forensic analysis on Windows. Here, we will learn how can we gather forensic data from the Windows registry and make conclusions about the activity performed on a Windows based system.</p> <h3 id="forensic-artifacts">Forensic Artifacts</h3> <p>Forensic artifacts are essential pieces of information that provide evidence of human activity. While it can be fingerprints or a broken button of a coat in real life, in computer corensics, artifacts can be small footprints of activity left on a system. These artifacts often reside in location <em>normal</em> users won’t typically venture to.</p> <h3 id="is-my-computer-spying-on-me-">Is my computer spying on me ?</h3> <p>Windows systems keeps track of a lot of activity performed by users. Even if it does not look like, these records are primarily made to improve the user’s experience.</p> <p>To illustrate, most out-of-he-box windows are similar for all users. However, with time, each user personalizes their computer according to their preferences. These include desktop layout, browser history, the different applications, other accounts…</p> <p>Windows saves the preferences to make computers more personalized. However, forensic investigators use these preferences as artifacts to identify the activity performed on a system. Hence, while computers might be spying on us, it is not for the explicit reason of spying but more to make the usage more pleasant.<br> Through this room, we will see the different locations where these artifacts are stored throughout the file system.</p> <h2 id="task-2---windows-registry-and-forensics">Task 2 - Windows registry and Forensics</h2> <h3 id="windows-registry">Windows Registry</h3> <p>The <em>Windows Registry</em> is a collection of databases that contains the <strong>system’s configuration data</strong>. This data can be about <strong>the hardware</strong>, <strong>the software</strong>, <strong>the user’s information</strong>, <strong>the recently used files</strong>, <strong>the used programs</strong> or <strong>devices connected to the system</strong>. As we can see, this data is beneficial from a forensic standpoint. It is possible to nattively consult the registry using <em>regedit</em>.<br> Unlike Windows, which uses a registry for system settings, Linux stores its main configuration files in the <code class="language-plaintext highlighter-rouge">/etc</code> directory.</p> <p>The <em>Windows Registry</em> is composed of <strong>Keys</strong> and <strong>Values</strong>. In <em>regedit</em>, folders represents the <strong>registry keys</strong> and data are stored in these keys into <strong>registry values</strong>. A <a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-hives" rel="external nofollow noopener" target="_blank">Registry Hive</a> is a group of keys, subkeys and values stored in a single file on the disk.</p> <h3 id="registry-structure">Registry Structure</h3> <p>The registry on any Windows system contains the following five root keys :</p> <ol> <li><strong>HKEY_CURRENT_USER</strong></li> <li><strong>HKEY_USERS</strong></li> <li><strong>HKEY_LOCAL_MACHINE</strong></li> <li><strong>HKEY_CLASSES_ROOT</strong></li> <li><strong>HKEY_CURRENT_CONFIG</strong></li> </ol> <p>These keys can be viewed with the registry editor <code class="language-plaintext highlighter-rouge">Win + R -&gt; regedit.exe</code>.</p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/r1747DJBkx.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Regedit Main View" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Root keys, keys and subkeys are shown in the <strong>left pane</strong> and the values of the selected key are show in the <strong>right pane</strong>.</p> <p>Microsoft <a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/performance/windows-registry-advanced-users" rel="external nofollow noopener" target="_blank">defines</a> each of these root keys as follow :</p> <table> <thead> <tr> <th><strong>Folder/Predefined Key</strong></th> <th><strong>Description</strong></th> </tr> </thead> <tbody> <tr> <td><strong>HKEY_CURRENT_USER</strong></td> <td>Contains the root of the configuration information for the user who is currently logged on. The user’s folders, screen colors, and Control Panel settings are stored here. This information is associated with the user’s profile. This key is sometimes abbreviated as <strong>HKCU</strong>.</td> </tr> <tr> <td><strong>HKEY_USERS</strong></td> <td>Contains all the actively loaded user profiles on the computer. <strong>HKEY_CURRENT_USER</strong> is a subkey of <strong>HKEY_USERS</strong>. <strong>HKEY_USERS</strong> is sometimes abbreviated as <strong>HKU</strong>.</td> </tr> <tr> <td><strong>HKEY_LOCAL_MACHINE</strong></td> <td>Contains configuration information particular to the computer (for any user). This key is sometimes abbreviated as <strong>HKLM</strong>.</td> </tr> <tr> <td><strong>HKEY_CLASSES_ROOT</strong></td> <td>Is a subkey of <strong>HKEY_LOCAL_MACHINE\Software</strong>. The information stored here ensures that the correct program opens when you open a file using Windows Explorer. This key is sometimes abbreviated as <strong>HKCR</strong>. Starting with Windows 2000, this information is stored under both the <strong>HKEY_LOCAL_MACHINE</strong> and <strong>HKEY_CURRENT_USER</strong> keys. <strong>HKEY_CLASSES_ROOT</strong> merges these two sources, providing a unified view for programs, especially those designed for earlier versions of Windows.</td> </tr> <tr> <td><strong>HKEY_CURRENT_CONFIG</strong></td> <td>Contains information about the hardware profile that is used by the local computer at system startup.</td> </tr> </tbody> </table> <h3 id="question">Question</h3> <p><strong>What is the short form for HKEY_LOCAL_MACHINE?</strong></p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">HKLM</code></em></p> <h2 id="task-3---accessing-registry-hives-offline">Task 3 - Accessing registry hives offline</h2> <p>If we are able to access to the live system, we will be able to access the regitry using regedit and be greeted with all of the standard root keys we previously learned about.</p> <p>However, with only an access to a disk image, we must know where the registry hives are located. The majority of these hives are located in the <code class="language-plaintext highlighter-rouge">C:\Windows\System32\Config</code>.</p> <table> <thead> <tr> <th><strong>Hive</strong></th> <th><strong>Mounted On</strong></th> <th><strong>Location</strong></th> <th><strong>Notes</strong></th> </tr> </thead> <tbody> <tr> <td><strong>DEFAULT</strong></td> <td>HKEY_USERS\DEFAULT</td> <td>C:\Windows\System32\Config\DEFAULT</td> <td>Contains default user profile settings used when no specific user is logged in. Serves as a baseline for initializing new user accounts.</td> </tr> <tr> <td><strong>SAM</strong></td> <td>HKEY_LOCAL_MACHINE\SAM</td> <td>C:\Windows\System32\Config\SAM</td> <td>Contains Security Account Manager (SAM) database.</td> </tr> <tr> <td><strong>SECURITY</strong></td> <td>HKEY_LOCAL_MACHINE\Security</td> <td>C:\Windows\System32\Config\SECURITY</td> <td>Contains security information.</td> </tr> <tr> <td><strong>SOFTWARE</strong></td> <td>HKEY_LOCAL_MACHINE\Software</td> <td>C:\Windows\System32\Config\SOFTWARE</td> <td>Contains software configuration information.</td> </tr> <tr> <td><strong>SYSTEM</strong></td> <td>HKEY_LOCAL_MACHINE\System</td> <td>C:\Windows\System32\Config\SYSTEM</td> <td>Contains system-specific information.</td> </tr> <tr> <td><strong>NTUSER.DAT</strong></td> <td>HKEY_CURRENT_USER</td> <td>C:\Users\NTUSER.DAT</td> <td>Contains user-specific configuration. Hidden file.</td> </tr> <tr> <td><strong>USRCLASS.DAT</strong></td> <td>HKEY_CURRENT_USER\Software\Classes</td> <td>C:\Users\AppData\Local\Microsoft\Windows\USRCLASS.DAT</td> <td>Contains user-specific software class information. Hidden file.</td> </tr> <tr> <td><strong>AmCache Hive</strong></td> <td>N/A</td> <td>C:\Windows\AppCompat\Programs\Amcache.hve</td> <td>Stores information about programs recently run on the system.</td> </tr> </tbody> </table> <h3 id="transation-logs-and-backups">Transation Logs and Backups</h3> <p>Some other vital sources of forensic data are the <strong>Registry Transaction Logs</strong> and <strong>Backups</strong>. These transaction logs can be considered as the <strong>journal or changelog of the registry hive</strong>. Windows often uses transaction logs when writing data to registry hives. This means transaction logs can often have the <strong>latest changes</strong> in the registry that have not yet been written to the registry hives themselves.<br> The transaction log for each hive is stored as a <strong><code class="language-plaintext highlighter-rouge">*.LOG</code></strong> file. Sometimes, there can be multiple transaction logs, named <strong><code class="language-plaintext highlighter-rouge">*.LOG1</code></strong>, <strong><code class="language-plaintext highlighter-rouge">*.LOG2</code></strong>, etc.</p> <p><strong>Registry Backups</strong> are essentially the <strong>opposite</strong> of <em>transaction logs</em>. These are backups of the registry hives located in <code class="language-plaintext highlighter-rouge">C:\Windows\System32\Config\</code>, which are copied to <code class="language-plaintext highlighter-rouge">C:\Windows\System32\Config\RegBack</code> every 10 days. This might be an excellent place to look if we suspect that some registry keys have been deleted or modified recently.</p> <h3 id="questions">Questions</h3> <p><strong>What is the path for the five main registry hives, DEFAULT, SAM, SECURITY, SOFTWARE, and SYSTEM?</strong></p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">C:\Windows\System32\Config</code></em></p> <p><strong>What is the path for the AmCache hive?</strong></p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">C:\Windows\AppCompat\Programs\Amcache.hve</code></em></p> <h2 id="task-4---data-acquisition">Task 4 - Data Acquisition</h2> <p>When performing forensics, it is possible to either encounter a live system or a system image. For the sake of accuracy and best practice, it is recommended to image the system or copy the required data and forensic on it. This process is called <strong>Data Acquisition</strong>.</p> <p>Though we can view the registry through <em>regedit</em> on a live system, the forensically correct method is to acquire a copy of this data and perform analysis on it.<br> However, because registry hives from <code class="language-plaintext highlighter-rouge">%WINDIR%\System32\Config</code> are restricted files (when copying with <em>explorer</em> to another place on a live system, we are greeted with the message <em>This action can’t be completed because the file is open in System</em>), we might use third-party tool.</p> <blockquote> <p><strong>Hypothesis</strong> Because the file is owned by <em>System</em>, we should elevate us to a similar privilege… (TBD with test on windows machine)</p> </blockquote> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/r1Cfb5lr1e.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Trying to copy registry hive on a live system" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="kape">KAPE</h3> <p><a href="https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape" rel="external nofollow noopener" target="_blank">KAPE</a> is a live data acquisition and analysis tool which can be used to acquire registry data. It is primarily a CLI tool but also comes with a GUI.<br> To extract registry data, we need to select registry components we want like :</p> <ul> <li><strong>RegistryHives</strong></li> <li><strong>RegistryHivesOther</strong></li> <li><strong>RegistryHivesSystem</strong></li> <li><strong>RegistryHivesUser</strong></li> <li><strong>Amcache</strong></li> </ul> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/HJB77qlH1l.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="KAPE Main UI" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="autopsy">Autopsy</h3> <p><a href="https://www.autopsy.com/" rel="external nofollow noopener" target="_blank">Autopsy</a> gives us the opton to acquire and analyze data from both live systems and disk images. After adding our data source, we must navigate to the location of the file we want to extract, here the registry hives location and then select the <em>Extract File(s)</em> option.</p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/B1emEclSkg.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Autopsy Extract Data" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="ftk-imager">FTK Imager</h3> <p>FTK Imager is similar to Autopsy and allow us to extract files from a disk image or a live system.</p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/rJK54qxBkg.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="FTK Imager Main UI" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Another way we can extract Registry files with this tool is through <em>Obtain Protected Files</em> option. This feature is available for live systems and allow us to extract all registry hives to a chosen location. However it will not copy <code class="language-plaintext highlighter-rouge">Amcache.hve</code>, which is often necessary to investigate evidence of last executed programs.</p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/HJhqSqlB1l.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="FTK Imager Obtain Protected Files" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h2 id="task-5---exploring-windows-registry">Task 5 - Exploring Windows Registry</h2> <p>Once registry hives are extracted, we need a tool to view these as <em>regedit</em> only works on live systems and cannot load exported hives.</p> <table> <thead> <tr> <th>Tool</th> <th>Key Features</th> <th>Limitations</th> <th>Supported OSes</th> </tr> </thead> <tbody> <tr> <td><strong>AccessData’s Registry Viewer</strong></td> <td>- User interface similar to Windows Registry Editor.</td> <td>- Loads only one hive at a time. <br> - Does not account for transaction logs.</td> <td>Windows</td> </tr> <tr> <td><strong>Zimmerman’s Registry Explorer</strong></td> <td>- Can load multiple hives simultaneously. <br> - Merges data from transaction logs for cleaner hives. <br> - Includes a ‘Bookmarks’ option for forensically important keys.</td> <td>- None significant; preferred tool for Digital Forensics.</td> <td>Windows</td> </tr> <tr> <td><strong>RegRipper</strong></td> <td>- Extracts forensically important keys and values from registry hives. <br> - CLI and GUI options available.</td> <td>- Does not account for transaction logs. <br> - Requires pre-processing with Registry Explorer for accuracy.</td> <td>Windows, Linux (via CLI)</td> </tr> <tr> <td><strong>RegistrySpy</strong></td> <td>- Open-source and written in Python. <br> - Platform-independent and customizable. <br> - Lightweight and easy to integrate into workflows.</td> <td>- May lack advanced features like transaction log processing. <br> - Potentially limited documentation and support.</td> <td>Windows, Linux, macOS</td> </tr> </tbody> </table> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/rkrSA9xSke.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Zimmerman's Registry Explorer" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h2 id="task-6---system-information-an-system-accounts">Task 6 - System Information an System Accounts</h2> <p>After learning how to read registry data, we need to know <strong>where to look interesting ones</strong> to perform our <strong>forensic analysis</strong>.</p> <h3 id="current-control-set">Current Control Set</h3> <p>Hives containing the machine’s configuration data used for <strong>controlling system startup</strong> are called <em>Control Sets</em>. These are located in the hive <em>SYSTEM</em> located into <code class="language-plaintext highlighter-rouge">C:\Windows\System32\config</code>. It is important to know them as they <strong>contain many forensic artifacts</strong>.<br> Commonly, there are two Control Sets :</p> <ul> <li> <strong>SYSTEM\ControlSet001</strong> : Control Set used at the machine’s boot</li> <li> <strong>SYSTEM\ControlSet002</strong> : Last known good configuration</li> </ul> <p>When the machine is live, Windows creates a volatile Control Set called <em>CurrentControlSet</em> at <code class="language-plaintext highlighter-rouge">HKLM\SYSTEM\CurrentControlSet</code>. For getting the most accurate information, this is the hive to refer to.<br> Furthermore, to know which ControlSet is being used as the CurrentControlSet, we must look at the registry value <code class="language-plaintext highlighter-rouge">SYSTEM\Select\Current</code>. Similarly, the <em>last known good</em> configuratio</p> <p>n can be found at <code class="language-plaintext highlighter-rouge">SYSTEM\Select\LastKnownGood</code>.</p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/SkU0d-y8Je.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer SYSTEM\Select" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="important-registry-locations">Important Registry Locations</h3> <p>Owing to the fact we know a bit more about <em>ControlSets</em>, we must know what data we might extract from registry values contained in them and in other Registry Hives. Below is a recap of those places.</p> <table> <thead> <tr> <th>Information</th> <th>Registry Location(s)</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><strong>OS Version</strong></td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows NT\CurrentVersion</code></td> <td>Determine the operating system version from which the data was pulled.</td> </tr> <tr> <td><strong>Current Control Set</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\ControlSet001</code></td> <td>Identify the active configuration and last known good configuration for accurate artifact analysis.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\ControlSet002</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\Select\Current</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\Select\LastKnownGood</code></td> <td> </td> </tr> <tr> <td><strong>Computer Name</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName</code></td> <td>Confirm the identity of the machine being analyzed.</td> </tr> <tr> <td><strong>Time Zone Information</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Control\TimeZoneInformation</code></td> <td>Establish the local time zone to ensure the correct chronology of events.</td> </tr> <tr> <td><strong>Network Interfaces</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces</code></td> <td>Obtain TCP/IP configurations, including IP addresses, DHCP, DNS, and Subnet Mask.</td> </tr> <tr> <td><strong>Past Networks</strong></td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged</code></td> <td>Identify previously connected networks and their last connection times.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Managed</code></td> <td> </td> </tr> <tr> <td><strong>Autostart Programs</strong></td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run</code></td> <td>Determine programs or services configured to start automatically during boot or user logon.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Services</code></td> <td> </td> </tr> <tr> <td><strong>SAM Hive and User Info</strong></td> <td><code class="language-plaintext highlighter-rouge">SAM\Domains\Account\Users</code></td> <td>Retrieve user account details, login history, password policies, and group memberships.</td> </tr> </tbody> </table> <h3 id="questions-1">Questions</h3> <p><strong>What is the Current Build Number of the machine whose data is being investigated?</strong></p> <p><em>CurrentBuild</em> in <code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows NT\CurrentVersion</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">19044</code></em></p> <p><strong>Which ControlSet contains the last known good configuration?</strong></p> <p><em>LastKnownGood</em> in <code class="language-plaintext highlighter-rouge">SYSTEM\Select\Current</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">1</code></em></p> <p><strong>What is the Computer Name of the computer?</strong></p> <p><em>ComputerName</em> in <code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">THM-4n6</code></em></p> <p><strong>What is the value of the <em>TimeZoneKeyName</em>?</strong></p> <p><em>TimeZoneKeyName</em> in <code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Control\TimeZoneInformation</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">Pakistan Standard Time</code></em></p> <p><strong>What is the DHCP IP address</strong></p> <p><em>DhcpIPAddress</em> in <code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">192.168.100.58</code></em></p> <p><strong>What is the RID of the Guest User account?</strong></p> <p><em>UserId</em> in <code class="language-plaintext highlighter-rouge">SAM\Domains\Account\Users</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">501</code></em></p> <h2 id="task-7---usage-or-knowledge-of-filesfolders">Task 7 - Usage or knowledge of Files/Folders</h2> <p>In order for Windows to remember about recent files or locations opened, these need to be stored somewhere, which is in the Registry. The common places to find information about this topic are in the following hives :</p> <ul> <li> <strong>NTUSER.DAT</strong>: <code class="language-plaintext highlighter-rouge">%USERPROFILE%\NTUSER.DAT</code> – Stores user-specific settings like preferences, recent files, and autostart entries.</li> <li> <strong>USRCLASS.DAT</strong>: <code class="language-plaintext highlighter-rouge">%USERPROFILE%\AppData\Local\Microsoft\Windows\UsrClass.dat</code> – Stores user-specific shell and GUI configurations.</li> </ul> <p>Here is a summary table for many types or file/folder tracking data in the registry :</p> <table> <thead> <tr> <th>Information</th> <th>Registry Location(s)</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><strong>Recent Files</strong></td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code></td> <td>Tracks recently accessed files. Also provides MRU data for specific file extensions (e.g., <code class="language-plaintext highlighter-rouge">.pdf</code>).</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.pdf</code></td> <td>Enables identification of files based on extensions, with timestamps for last access.</td> </tr> <tr> <td><strong>Office Recent Files</strong></td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Office\VERSION</code></td> <td>Tracks recent Office document activity by application (e.g., Word, Excel).</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Office\VERSION\UserMRU\LiveID_####\FileMRU</code></td> <td>Contains detailed paths of recently accessed Office files tied to user accounts.</td> </tr> <tr> <td><strong>ShellBags</strong></td> <td><code class="language-plaintext highlighter-rouge">USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags</code></td> <td>Tracks folder view settings and layouts for each user, along with the history of accessed directories.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU</code></td> <td>ShellBags can help identify the Most Recently Used (MRU) folders and files, even for deleted or moved folders, aiding in reconstructing user activity.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags</code></td> <td> </td> </tr> <tr> <td><strong>Open/Save and LastVisited Dialog MRUs</strong></td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePIDlMRU</code></td> <td>Tracks recently accessed files via open/save dialog boxes, aiding in identifying file interaction.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU</code></td> <td>Tracks recent folder or file locations visited via dialogs.</td> </tr> <tr> <td><strong>Windows Explorer Address/Search Bars</strong></td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths</code></td> <td>Records paths typed in the Windows Explorer address bar, helping trace user navigation.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery</code></td> <td>Tracks searches performed in Windows Explorer.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run</code></td> <td> </td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Services</code></td> <td> </td> </tr> </tbody> </table> <h3 id="questions-2">Questions</h3> <p><strong>When was EZtools opened?</strong></p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/SkofnfkIyl.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer Recent Files" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><em>OpenedOn</em> in <code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">2021-12-01 13:00:34</code></em></p> <p><strong>At what time was My Computer last interacted with?</strong></p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/SJh23GkIkx.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="ShellBags Explorer" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><em>LastInteracted</em> in <code class="language-plaintext highlighter-rouge">USRCLASS.DAT</code> using <em>ShellBags Explorer</em> by Eric Zimmerman.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">2021-12-01 13:06:47</code></em></p> <p><strong>What is the Absolute Path of the file opened using notepad.exe?</strong></p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/H1jepfJLJe.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer Last Visited Dialog MRUs" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><em>AbsolutePath</em> in <code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU</code>.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">C:\Program Files\Amazon\Ec2ConfigService\Settings</code></em></p> <p><strong>When was this file opened?</strong></p> <p><em>OpenedOn</em> at the same location as before.</p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">2021-11-30 10:56:19</code></em></p> <h2 id="task-8---evidence-of-execution">Task 8 - Evidence of Execution</h2> <p>For statistical purposes, Windows keeps track of applications launched by the user using Windows Explorer. These informations are contained into the Registry within many Hives. Down below is a summary of the different execution data that are possible to retrieve :</p> <table> <thead> <tr> <th>Evidence Type</th> <th>Registry Location</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><strong>UserAssist</strong></td> <td><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{GUID}\Count</code></td> <td>Tracks programs launched via Windows Explorer, including launch time and execution count. Does not include programs run from the command line.</td> </tr> <tr> <td><strong>ShimCache</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache</code></td> <td>Tracks all launched applications for compatibility purposes, storing file names, sizes, and last modified times. It is also called <em>Application Compatibility Cache</em> (AppCompatCache).</td> </tr> <tr> <td> </td> <td> </td> <td>Because Registry Explorer does not parse ShimCache Data in a human-readable format, we need to first use <em>AppCompatCacheParser</em>, which exports it in <em>csv</em> and then, view it using <em>EZviewer</em>.</td> </tr> <tr> <td><strong>AmCache</strong></td> <td><code class="language-plaintext highlighter-rouge">C:\Windows\appcompat\Programs\Amcache.hve\Root\File\{Volume GUID}\</code></td> <td>Artifact related to ShimCache. Provides detailed data on executed programs, including execution path, times (install, execute, delete), and SHA1 hashes.</td> </tr> <tr> <td><strong>BAM/DAM</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Services\bam\UserSettings\{SID}</code></td> <td>Monitors background and desktop application activity, including last run programs, their paths, and last execution times to optimize power consumption.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Services\dam\UserSettings\{SID}</code></td> <td> </td> </tr> </tbody> </table> <h3 id="questions-3">Questions</h3> <p><strong>How many times was the File Explorer launched?</strong></p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/SJ0ygNyUJx.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer " loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <ul> <li> <strong>Value</strong> : <em>RunCounter</em> </li> <li> <strong>Location</strong> :<code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{GUID}\Count</code> </li> <li> <strong>Program Name</strong> : <em>{User Pinned}\Taskbar\File Explorer.Ink</em> </li> </ul> <p><em>Answer : <code class="language-plaintext highlighter-rouge">26</code></em></p> <p><strong>What is another name for ShimCache?</strong></p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">AppCompatCache</code></em></p> <p><strong>Which of the artifacts also saves SHA1 hashes of the executed programs?</strong></p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">AmCache</code></em></p> <p><strong>Which of the artifacts saves the full path of the executed programs?</strong></p> <p><em>Answer : <code class="language-plaintext highlighter-rouge">BAM/DAM</code></em></p> <h2 id="task-9---external-devicesusb-device-forensics">Task 9 - External Devices/USB device forensics</h2> <p>When performing forensics on a machine, there is often the need to identify if any USB or removable devices were attached to the machine and some of their characteristics. Subsequently, there are different ways to find information on connected devices and system drives on a system using the registry, which are resumed in the table below :</p> <table> <thead> <tr> <th><strong>Information</strong></th> <th><strong>Registry Location</strong></th> <th><strong>Purpose</strong></th> </tr> </thead> <tbody> <tr> <td><strong>Device Identification</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Enum\USBSTOR</code></td> <td>Tracks USB devices connected to the system, including vendor ID, product ID, and version.</td> </tr> <tr> <td> </td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Enum\USB</code></td> <td>Stores identification details of USB devices plugged into the system.</td> </tr> <tr> <td><strong>First/Last Times</strong></td> <td><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USBSerial#\Properties\{83da6326-97a6-4088-9453-a19231573b29}\####</code></td> <td>Tracks the first and last times the device was connected and the last time it was removed. The <em>####</em> sign needs to be replaced by the following digits.</td> </tr> <tr> <td> </td> <td> <strong>Value Codes</strong>: <code class="language-plaintext highlighter-rouge">0064</code> (First Connection time), <code class="language-plaintext highlighter-rouge">0066</code> (Last Connection time), <code class="language-plaintext highlighter-rouge">0067</code> (Last Removal time)</td> <td>Provides timestamp data for when the USB device was connected or removed. This data is already parsed by <em>Registry Explorer</em> if <em>USBSTOR</em> key is selected.</td> </tr> <tr> <td><strong>USB Device Volume Name</strong></td> <td><code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows Portable Devices\Devices</code></td> <td>Stores the device name of the connected USB drive, used to correlate with unique devices.</td> </tr> </tbody> </table> <h3 id="questions-4">Questions</h3> <p><strong>What is the serial number of the device from the manufacturer ‘Kingston’?</strong></p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/Sya1V4JL1l.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer USB Device identification" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <ul> <li> <strong>Value</strong> : <em>SerialNumber</em> </li> <li> <strong>Location</strong> : <code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Enum\USBSTOR</code> </li> </ul> <p><em>Answer : <code class="language-plaintext highlighter-rouge">1C6f654E59A3B0C179D366AE&amp;0</code></em></p> <p><strong>What is the name of this device?</strong></p> <p>Using the same image as the <em>Question 1</em>.</p> <ul> <li> <strong>Value</strong> : <em>DeviceName</em> </li> <li> <strong>Location</strong> : <code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Enum\USBSTOR</code> </li> </ul> <p><em>Answer : <code class="language-plaintext highlighter-rouge">Kingston Data Traveler 2.0 USB Device</code></em></p> <p><strong>What is the friendly name of the device from the manufacturer ‘Kingston’?</strong></p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/B1dzB418kx.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer USB device Volume Name" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <ul> <li> <strong>Value</strong> : <em>Friendly Name</em> </li> <li> <strong>Location</strong> : <code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows Portable Devices\Devices</code> </li> </ul> <p><em>Answer : <code class="language-plaintext highlighter-rouge">USB</code></em></p> <h2 id="task-10---hands-on-challenge">Task 10 - Hands-on Challenge</h2> <p>In this task, we are required to make a <strong>forensic analysis on a triage</strong> (Quick, initial collection of key forensic artifacts from a system) to put in practice what we have learnt. Below is the presented challenge setup.</p> <pre><code class="language-raw">The Setup

If preferred, use the following credentials to log into the machine:

Username: THM-4n6

Password: 123

Once we log in, we will see two folders on the Desktop named triage and EZtools. The triage folder contains a triage collection collected through KAPE, which has the same directory structure as the parent. This is where our artifacts will be located. The EZtools folder contains Eric Zimmerman's tools, which we will be using to perform our analysis. You will also find RegistryExplorer, EZViewer, and AppCompatCacheParser.exe in the same folder.

The Challenge

Now that we know where the required toolset is, we can start our investigation. We will have to use our knowledge to identify where the different files for the relevant registry hives are located and load them into the tools of our choice. Let's answer the questions below using our knowledge of registry forensics.

Scenario

One of the Desktops in the research lab at Organization X is suspected to have been accessed by someone unauthorized. Although they generally have only one user account per Desktop, there were multiple user accounts observed on this system. It is also suspected that the system was connected to some network drive, and a USB device was connected to the system. The triage data from the system was collected and placed on the attached VM. Can you help Organization X with finding answers to the below questions?

Note: When loading registry hives in RegistryExplorer, it will caution us that the hives are dirty. This is nothing to be afraid of. We just need to remember the little lesson about transaction logs and point RegistryExplorer to the .LOG1 and .LOG2 files with the same filename as the registry hive. It will automatically integrate the transaction logs and create a 'clean' hive. Once we tell RegistryExplorer where to save the clean hive, we can use that for our analysis and we won't need to load the dirty hives anymore. RegistryExplorer will guide you through this process. 
</code></pre> <h3 id="questions-5">Questions</h3> <p><strong>How many user created accounts are present on the system?</strong></p> <ul> <li> <strong>Hive Location</strong> : <code class="language-plaintext highlighter-rouge">C:\Windows\System32\config\SAM</code> </li> <li> <strong>Registry Location</strong> : <code class="language-plaintext highlighter-rouge">SAM\Domains\Account\Users</code> </li> </ul> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/H1mbjEJLJe.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer User Accounts" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><em>Answer : <code class="language-plaintext highlighter-rouge">3</code></em></p> <blockquote> <p><strong>Note</strong> Here <em>Registry Explorer</em> automatically parses every users’ values. Normally, all these values are stored in a binary form like below.</p> </blockquote> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/Bkg02NyIyx.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="A user in the Registry" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><strong>What is the username of the account that has never been logged in?</strong></p> <ul> <li> <strong>Hive Location</strong> : <code class="language-plaintext highlighter-rouge">C:\Windows\System32\config\SAM</code> </li> <li> <strong>Registry Location</strong> : <code class="language-plaintext highlighter-rouge">SAM\Domains\Account\Users</code> </li> <li> <strong>Registry Value</strong> : <em>Last Login Time</em> </li> </ul> <p><em>Answer : <code class="language-plaintext highlighter-rouge">thm-user2</code></em></p> <p><strong>What’s the password hint for the user THM-4n6?</strong></p> <ul> <li> <strong>Hive Location</strong> : <code class="language-plaintext highlighter-rouge">C:\Windows\System32\config\SAM</code> </li> <li> <strong>Registry Location</strong> : <code class="language-plaintext highlighter-rouge">SAM\Domains\Account\Users</code> </li> <li> <strong>Registry Value</strong> : <em>Password Hint</em> </li> </ul> <p><em>Answer : <code class="language-plaintext highlighter-rouge">count</code></em></p> <p><strong>When was the file ‘Changelog.txt’ accessed?</strong></p> <p>The <em>Find</em> feature of <em>Registry Explorer</em> can also be used to find certain <em>Key Values</em>. Moreover, when I loaded in the <em>NTUSER.DAT</em> hive, I was requested to load transaction logs <em>NTUSER.DAT.log1</em> and <em>NTUSER.DAT.log2</em> to create a clean hive.</p> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/ry1TkBk8Je.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer Find tool" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <ul> <li> <strong>Hive Location</strong> : <code class="language-plaintext highlighter-rouge">%USERPROFILE%\NTUSER.DAT</code> </li> <li> <strong>Registry Location</strong> : <code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code> </li> <li> <strong>Registry Value</strong> : <em>Opened On</em> </li> </ul> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/Hkc5JSk8kx.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer Recent Docs" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><em>Answer : <code class="language-plaintext highlighter-rouge">2021-11-24 18:18:48</code></em></p> <p><strong>What is the complete path from where the python 3.8.2 installer was run?</strong></p> <blockquote> <p><strong>Note</strong><br> GUIDs are unique identifiers used to track the type of access to files and applications. For example:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}</code> tracks a list of applications, files, and other objects accessed.</li> <li> <code class="language-plaintext highlighter-rouge">{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}</code> lists the shortcut links used to start programs. Here we need to know the data that corresponds to the python 3.8.2 installer, hence we will check into the first mentioned GUID.</li> </ul> </blockquote> <ul> <li> <strong>Hive Location</strong> : <code class="language-plaintext highlighter-rouge">%USERPROFILE%\NTUSER.DAT</code> </li> <li> <strong>Registry Location</strong> : <code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}\Count</code> </li> <li> <strong>Registry Value</strong> : <em>Last Executed</em> </li> </ul> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/r17E-By81x.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer Recently Opened Files" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>*Answer : <code class="language-plaintext highlighter-rouge">Z:\setups\python-3.8.2.exe</code></p> <p><strong>When was the USB device with the friendly name ‘USB’ last connected?</strong></p> <p>Firstly, we need to retrieve the usb device’s GUID.</p> <ul> <li> <strong>Hive Location</strong> : <code class="language-plaintext highlighter-rouge">C:\Windows\System32\SOFTWARE</code> </li> <li> <strong>Registry Location</strong> : <code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows Portable Devices</code> </li> <li> <strong>Registry Value</strong> : <em>GUID</em> </li> </ul> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/r1ZQTHkIkx.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer Portable Devices" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Then, we have to correlate the GUID <em>{e251…7110}</em> of the device’s frieldy name <em>USB</em> to the one located in <em>USBSTOR</em>, in order to get the last connected timestamp.</p> <ul> <li> <strong>Hive Location</strong> : <code class="language-plaintext highlighter-rouge">C:\Windows\System32\SYSTEM</code> </li> <li> <strong>Registry Location</strong> : `SYSTEM\ControlSet001\Enum\USBSTOR</li> <li> <strong>Registry Value</strong> : <em>Last Connected</em> </li> </ul> <figure> <picture> <img src="/assets/img/images/2024-12-17-thm-windows-forensics-1/HkAXAr1U1e.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Registry Explorer USB Storage" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><em>Answer : <code class="language-plaintext highlighter-rouge">2021-11-24 18:40:06</code></em></p> <h2 id="task-11---conclusion">Task 11 - Conclusion</h2> <p>In conclusion, Windows registry forensics is essential for extracting and analyzing system and user activity data. Accessing offline registry hives allows forensic investigators to examine system information, including OS version, hardware configuration, user accounts, and device interactions. Tools like Registry Explorer and Eric Zimmerman’s utilities simplify the exploration of registry hives and provide insights into system and user activity. Key areas include evidence of file and application usage (via <code class="language-plaintext highlighter-rouge">UserAssist</code> and <code class="language-plaintext highlighter-rouge">ShimCache</code>), external device connection history (via USBSTOR), and user activity regarding files and folders. These artifacts offer a comprehensive understanding of system behavior, application execution, and device interactions, providing crucial evidence for forensic investigations.</p> <p>A Windows Forensics Cheat Sheet made by <em><a href="https://tryhackme.com/p/umairalizafar" rel="external nofollow noopener" target="_blank">umairalizafar</a></em>, the author of this room, is available <a href="https://assets.tryhackme.com/cheatsheets/Windows%20Forensics%20Cheatsheet.pdf" rel="external nofollow noopener" target="_blank">here</a>.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/THM-Windows-Forensics-2/">THM Windows Forensics 2</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/THM-MalDoc-Static-Analysis/">THM MalDoc: Static Analysis</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/THM-Advanced-Static-Analysis/">THM Advanced Static Analysis</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/THM-Basic-Dynamic-Analysis/">THM Basic Dynamic Analysis</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/THM-Anti-Reverse-Engineering/">THM Anti-Reverse Engineering</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 NonoHM . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>