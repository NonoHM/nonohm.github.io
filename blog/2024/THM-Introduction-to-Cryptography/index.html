<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> THM Introduction to Cryptography | NonoHM </title> <meta name="author" content="NonoHM "> <meta name="description" content="Welcome to my personnal website. I am currently a 2nd year student in the " but r et t program. i like doing sports and music besides learning new things in it.> <meta name="keywords" content="jekyll, jekyll-theme, portfolio-website, writeups, projects"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nonohm.github.io/blog/2024/THM-Introduction-to-Cryptography/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> NonoHM </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">THM Introduction to Cryptography</h1> <p class="post-meta"> February 11, 2024 • NonoHM </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/thm"> <i class="fa-solid fa-hashtag fa-sm"></i> THM</a>   <a href="/blog/tag/security-engineer"> <i class="fa-solid fa-hashtag fa-sm"></i> Security Engineer</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="task-1---introduction">Task 1 - Introduction</h2> <p>The purpose of this room is to introduce users to basic cryptography concepts such as:</p> <ul> <li>Symmetric encryption, such as AES</li> <li>Asymmetric encryption, such as RSA</li> <li>Diffie-Hellman Key Exchange</li> <li>Hashing</li> <li>PKI</li> </ul> <p>One of the earliest cryptographic mechanism is Ceasar Cipher. Its priciple is to shift the letter by a fixed number of places to the left or right. Consequently the key is between 1 and 25, the number of shifts. Example: TryHackMe -&gt; WubKdfnPh with a key of 3.</p> <p>This is a <strong>substitution cipher</strong> because we replace each letter by another. Another type of cipher is called <strong>transposition cipher</strong>, which encrypts the message by changing the order of the letters.</p> <figure> <picture> <img src="/assets/img/images/thm_introduction_to_cryptography/B1leoiUja.png" class="img-fluid rounded z-depth-1 bg-white" width="100%" height="auto" title="Transpoition Cipher Example" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>For an encryption algorithm to be considered <strong>secure</strong>, it should be infeasible to recover the original message in a reasonable time.</p> <h3 id="questions">Questions</h3> <p><strong>You have received the following encrypted message:</strong></p> <p><em>“Xjnvw lc sluxjmw jsqm wjpmcqbg jg wqcxqmnvw; xjzjmmjd lc wjpm sluxjmw jsqm bqccqm zqy.” Zlwvzjxj Zpcvcol</em></p> <p><strong>You can guess that it is a quote. Who said it?</strong></p> <p>Using <a href="https://www.quipqiup.com/" rel="external nofollow noopener" target="_blank">quipquip</a>.</p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">Miyamoto Musashi</code></em></p> <h2 id="task-2---symmetric-encryption">Task 2 - Symmetric Encryption</h2> <p>Let’s review some terminology:</p> <ul> <li> <strong>Cryptographic Algorithm</strong> or <strong>Cipher</strong>: This algorithm defines the encryption and decryption processes.</li> <li> <strong>Key</strong>: The cryptographic algorithm needs a key to convert the plaintext into ciphertext and vice versa.</li> <li> <strong>Plaintext</strong>: original message that we want to encrypt</li> <li> <strong>Ciphertext</strong>: message in its encrypted form</li> </ul> <p>A symmetric encryption algorithm uses the same key for encryption and decryption. Consequently, the communicating parties need to agree on a secret key before being able to exchange any messages.</p> <p>In 1977, the Data Encryption Standard (DES) was puslished by the National Institute of Standard and Technology (NIST). This is an encryption algorithm that uses a key size of 56 bits and it nowadays considered as an insecure cypher algoritm because it has demonstrated that the key could be brute-force searched.</p> <p>In 2001, the same organization published the Advanced Encryption Standard (AES). Like DES it is a symmetric algorithm but it uses keys of 128, 196 or 256 bits ans it is still considered as secure today. AES iterate through these transformations multiple times:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">SubBytes(state)</code>: This transformation looks up each byte in a given substitution table (S-box) and substitutes it with the respective value. The state is 16 bytes, i.e., 128 bits, saved in a 4 by 4 array.</li> <li> <code class="language-plaintext highlighter-rouge">ShiftRows(state)</code>: The second row is shifted by one place, the third row is shifted by two places, and the fourth row is shifted by three places.</li> <li> <code class="language-plaintext highlighter-rouge">MixColumns(state)</code>: Each column is multiplied by a fixed matrix (4 by 4 array).</li> <li> <code class="language-plaintext highlighter-rouge">AddRoundKey(state)</code>: A round key is added to the state using the XOR operation.</li> </ul> <p>In order to encrypt, strings are converted into their hexadecimal values. Then these are encrypted using block or stream algorithms:</p> <ul> <li> <strong>Block</strong>: Characters are concatenated into blocks of a defined size and then encrypted.</li> <li> <strong>Stream</strong>: Each character is encrypted at a time.</li> </ul> <p>Symmetric encyption solves the CIA Triad problem:</p> <ul> <li> <strong>Confidentiality</strong>: The message cannot be understood without the key</li> <li> <strong>Integrity</strong>: Even minor modifications lead to gibberish plaint text.</li> <li> <strong>Authenticity</strong>: Only the conserned parts must know the key.</li> </ul> <p>These two programsare widely use for symmetric but asymmetric encryption as well:</p> <ul> <li>GNU Privacy Guard</li> <li>OpenSSL Project</li> </ul> <h3 id="gnu-privacy-guard">GNU Privacy Guard</h3> <ul> <li>Encryption</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--symmetric</span> <span class="nt">--armor</span> <span class="nt">--cipher-algo</span> CIPHER message.txt
</code></pre></div></div> <blockquote> <p><code class="language-plaintext highlighter-rouge">--armor</code> option makes an ascii output</p> </blockquote> <ul> <li>Decryption</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--output</span> original_message.txt <span class="nt">--decrypt</span> message.gpg
</code></pre></div></div> <h3 id="openssl-project">OpenSSL Project</h3> <ul> <li>Encrypt</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl aes-256-cbc <span class="nt">-pbkdf2</span> <span class="nt">-iter</span> 10000 <span class="nt">-e</span> <span class="nt">-in</span> message.txt <span class="nt">-out</span> encrypted_message
</code></pre></div></div> <blockquote> <p><code class="language-plaintext highlighter-rouge">-pbkdf2</code> and <code class="language-plaintext highlighter-rouge">-iter &lt;number&gt;</code> options are optional but makes the encryption more secure and resilient against brute-force attacks</p> </blockquote> <ul> <li>Decrypt</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl aes-256-cbc <span class="nt">-pbkdf2</span> <span class="nt">-iter</span> 10000 <span class="nt">-d</span> <span class="nt">-in</span> encrypted_message <span class="nt">-out</span> original_message.txt
</code></pre></div></div> <h3 id="questions-1">Questions</h3> <p><strong>Decrypt the file quote01 encrypted (using AES256) with the key <code class="language-plaintext highlighter-rouge">s!kR3T55</code> using gpg. What is the third word in the file?</strong></p> <p>The used command: <code class="language-plaintext highlighter-rouge">gpg --output quote01.txt --decrypt quote01.txt.gpg</code></p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">waste</code></em></p> <p><strong>Decrypt the file quote02 encrypted (using AES256-CBC) with the key <code class="language-plaintext highlighter-rouge">s!kR3T55</code> using openssl. What is the third word in the file?</strong></p> <p>The used command: <code class="language-plaintext highlighter-rouge">openssl aes-256-cbc -d -in quote02 -out quote02.txt</code></p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">science</code></em></p> <p><strong>Decrypt the file quote03 encrypted (using CAMELLIA256) with the key <code class="language-plaintext highlighter-rouge">s!kR3T55</code> using gpg. What is the third word in the file?</strong></p> <p>The used command: <code class="language-plaintext highlighter-rouge">gpg --output quote03.txt --decrypt quote03.txt.gpg</code></p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">understand</code></em></p> <h2 id="task-3---asymmetric-encryption">Task 3 - Asymmetric Encryption</h2> <p>Symmetric encryption requires the users to find a secure channel to exchange keys. By secure channel, we are mainly concerned with confidentiality and integrity. In other words, we need a channel where no one can change and read the sent messages.</p> <p>Asymmetric encryption makes it possible to exchange encrypted messages without a secure channel; we just need a reliable channel. When using an asymmetric encryption algorithm, we would generate a key pair: a public key and a private key.</p> <ul> <li> <strong>Public key</strong>: Shared key used to encrypt the data.</li> <li> <strong>Private key</strong>: Never shared to anyone, used to decrypt the data.</li> </ul> <h3 id="confidentiality">Confidentiality</h3> <p>Confidentiality is achieved by encrypting using the public key and decrypting using the private key.</p> <h3 id="integrity-authenticity-and-nonrepudiation">Integrity, Authenticity, and Nonrepudiation</h3> <p>They are achieved by encrypting using the private key and decrypting using the public key. Because the owner is normally the only one who have the key, this proves he is really the author.</p> <ul> <li> <strong>Integrity</strong>: The message is not altered.</li> <li> <strong>Authenticity</strong>: By successfully de-signing using the public key, it proves the author of the message by comparing the encrypted and the de-signed encrypted message.</li> <li> <strong>Nonrepudation</strong>: Nobody can deny the origin of the message.</li> </ul> <p>Asymmetric ciphers can cover more fields than the symmetrical ones but it can’t encrypt large amount of data fast.</p> <p>Two main asymmetric encrypting methods exists today:</p> <ul> <li>RSA</li> <li>Eliptic Curves</li> </ul> <h3 id="rsa">RSA</h3> <p>RSA got its name from its inventors, Rivest, Shamir, and Adleman. It works as follows:</p> <ol> <li>Choose two random prime numbers, p and q. Calculate N = p × q.</li> <li>Choose two integers e and d such that e × d = 1 mod ϕ(N), where ϕ(N) = N − p − q + 1. This step will let us generate the public key (N,e) and the private key (N,d).</li> <li>The sender can encrypt a value x by calculating y = xe mod N. (Modulus)</li> <li>The recipient can decrypt y by calculating x = y^d mod N. Note that y^d = x^ed = x^kϕ(N) + 1 = ((x^ϕ(N))^k) × x = x. This step explains why we put a restriction on the choice of e and d.</li> </ol> <p>RSA security relies on factorization being a hard problem. It is easy to multiply p by q; however, it is time-consuming to find p and q given N. Moreover, for this to be secure, p and q should be pretty large numbers. It is important to note that RSA relies on secure random number generation, as with other asymmetric encryption algorithms. If an adversary can guess p and q, the whole system would be considered insecure.</p> <h3 id="openssl">OpenSSL</h3> <ul> <li>Generate a new private key</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genrsa <span class="nt">-out</span> private-key.pem 2048
</code></pre></div></div> <ul> <li>Derive that private key to a public key</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rsa <span class="nt">-in</span> private-key.pem <span class="nt">-pubout</span> <span class="nt">-out</span> public-key.pem
</code></pre></div></div> <ul> <li>To see RSA variables used</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rsa <span class="nt">-in</span> private-key.pem <span class="nt">-text</span> <span class="nt">-noout</span>
</code></pre></div></div> <ul> <li>To encrypt</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl pkeyutl <span class="nt">-encrypt</span> <span class="nt">-in</span> plaintext.txt <span class="nt">-out</span> ciphertext <span class="nt">-inkey</span> public-key.pem <span class="nt">-pubin</span>
</code></pre></div></div> <ul> <li>To decrypt</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl pkeyutl <span class="nt">-decrypt</span> <span class="nt">-in</span> ciphertext <span class="nt">-inkey</span> private-key.pem <span class="nt">-out</span> decrypted.txt
</code></pre></div></div> <h3 id="questions-2">Questions</h3> <p><em>Files located in task03</em></p> <p><strong>Bob has received the file <code class="language-plaintext highlighter-rouge">ciphertext_message</code> sent to him from Alice. You can find the key you need in the same folder. What is the first word of the original plaintext?</strong></p> <p>We need to decrypt using the bob’s private key using the following command: <code class="language-plaintext highlighter-rouge">openssl pkeyutl -decrypt -in ciphertext_message -inkey private-key-bob.pem -out plaintext_message.txt</code>.</p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">Perception</code></em></p> <p>Take a look at Bob’s private RSA key. What is the last byte of p?</p> <p>The used command: <code class="language-plaintext highlighter-rouge">openssl rsa -in private-key-bob.pem -text -noout | more</code>.</p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">e7</code></em></p> <p>Take a look at Bob’s private RSA key. What is the last byte of q?</p> <p>Same command used.</p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">27</code></em></p> <h2 id="task-4---diffie-hellman-key-exchange">Task 4 - Diffie-Hellman Key Exchange</h2> <p>Diffie-Hellman is an asymmetric encryption algorithm which allow the exchange of a secret over a public channel. This works using power and modulus:</p> <ol> <li>Alice and Bob agrees on <em>q</em> and <em>g</em>; <em>q</em> is a prime number and <em>g &lt; q</em>.</li> <li>Alice and Bob picks respectively, a private number <em>a</em> and <em>b</em> smaller than q.</li> <li> <table> <tbody> <tr> <td>They calculate *A/B = g^(a</td> <td>b) mod q*</td> </tr> </tbody> </table> </li> <li>These are sent to each other.</li> <li> <table> <tbody> <tr> <td>They calculate *k = (A</td> <td>B)^(a</td> <td>b) mod q*</td> </tr> </tbody> </table> </li> </ol> <p>Finally they reach the same key. In real life, chosen numbers mostly are 256 bits in length.</p> <p>Here is a simplified diagram:</p> <p><img src="/assets/img/images/thm_introduction_to_cryptography/HJP74TIia.png" alt="Diffie-Hellman algorithm with colors. Source: ResearchGate"></p> <h3 id="openssl-1">OpenSSL</h3> <ul> <li>To generate Diffie-Hellman parameters</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl dhparam <span class="nt">-out</span> dhparams.pem 2048
</code></pre></div></div> <blockquote> <p><code class="language-plaintext highlighter-rouge">-text -noout</code> options to directly see parameters instead of <code class="language-plaintext highlighter-rouge">-out</code>.</p> </blockquote> <ul> <li>To see the parameters</li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl dhparam <span class="nt">-in</span> dhparams.pem <span class="nt">-text</span> <span class="nt">-noout</span>
</code></pre></div></div> <h3 id="questions-3">Questions</h3> <p><em>Files located in task04</em></p> <p><em>A set of Diffie-Hellman parameters can be found in the file <code class="language-plaintext highlighter-rouge">dhparam.pem</code>. What is the size of the prime number in bits?</em></p> <p>The used command: <code class="language-plaintext highlighter-rouge">openssl dhparam -in dhparams.pem -text -noout</code></p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">4096</code></em></p> <p>What is the prime number’s last byte (least significant byte)?</p> <p>Same command used.</p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">4f</code></em></p> <h2 id="task-5---hashing">Task 5 - Hashing</h2> <p>A cryptographic hash function is an algorithm that takes data of arbitrary size as its input and returns a fixed size value, called <em>message digest</em> or <em>checksum</em>, as its output. The returned value is always the same for the same input data and should never be the same even with the most minor modification. An example of hashing algorithm is <em>SHA256</em>. The 256 indicates that the message digest size is 256 bits long.</p> <p>This type of function is useful for:</p> <ul> <li> <strong>Storing passwords</strong>: Passwords are stored in their hashed format. This is useful when a data breach occus in order to protect them.</li> <li> <strong>Detecting Modifications</strong>: Any modifications, like said before, lead to a drastic hash value change.</li> </ul> <p>Some of the hashing algorithms in use and still considered secure are:</p> <ul> <li>SHA224, SHA256, SHA384, SHA512</li> <li>RIPEMD160</li> </ul> <p>To calculate hash on linux, we have tools like <code class="language-plaintext highlighter-rouge">sha256sum</code>…</p> <h3 id="hmac">HMAC</h3> <p>Hash-based message authentication code (HMAC) is a message authentication code (MAC) that uses a cryptographic key in addition to a hash function.</p> <p>According to RFC2104, HMAC needs:</p> <ul> <li>Secret key</li> <li>Inner pad (ipad) a constant string. (RFC2104 uses the byte 0x36 repeated B times. The value of B depends on the chosen hash function.)</li> <li>Outer pad (opad) a constant string. (RFC2104 uses the byte 0x5C repeated B times.)</li> </ul> <p>The HMAC is calculated as the following:</p> <ol> <li>Fill the key with zeroes to make it the length of B, length which match that of the ipad.</li> <li> <em>key ⊕ ipad</em>.</li> <li>Append the message to it and apply the hash function.</li> <li><em>key ⊕ opad</em></li> <li>Append the result to the hash output from step 3.</li> <li>Apply the hash function.</li> </ol> <p>This represents the formula: <em>H(K⊕opad,H(K⊕ipad,text))</em>.</p> <blockquote> <p>Note: ⊕ = XOR operation</p> </blockquote> <p>To calculate hmac on linux, we have tools like <code class="language-plaintext highlighter-rouge">sha256hmac</code>…</p> <h3 id="questions-4">Questions</h3> <p><em>Files located in task05</em></p> <p><strong>What is the SHA256 checksum of the file <code class="language-plaintext highlighter-rouge">order.json</code>?</strong></p> <p>Using the following command: <code class="language-plaintext highlighter-rouge">sha256sum order.json</code></p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">2c34b68669427d15f76a1c06ab941e3e6038dacdfb9209455c87519a3ef2c660</code></em></p> <p>** Open the file <code class="language-plaintext highlighter-rouge">order.json</code> and change the amount from <em>1000</em> to <em>9000</em>. What is the new SHA256 checksum?**</p> <p>Changing the amount and using the same command.</p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">11faeec5edc2a2bad82ab116bbe4df0f4bc6edd96adac7150bb4e6364a238466</code></em></p> <p><strong>Using SHA256 and the key <code class="language-plaintext highlighter-rouge">3RfDFz82</code>, what is the HMAC of <code class="language-plaintext highlighter-rouge">order.txt</code>?</strong></p> <p>Using the following command: <code class="language-plaintext highlighter-rouge">hmac256 3RfDFz82 order.txt</code></p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">c7e4de386a09ef970300243a70a444ee2a4ca62413aeaeb7097d43d2c5fac89f</code></em></p> <h2 id="task-6---pki-and-ssltls">Task 6 - PKI and SSL/TLS</h2> <p>Like we have seen before, the Diffie-hellman key exchange allows us to agree on a secret key without sending it on a network. However, this protocol is not immune to Man In The Middle (MITM) Attacks. The reason is that there is no way of ensuring the authenticity of the two sides.</p> <p>Here is a diagram explaining this:</p> <figure> <picture> <img src="/assets/img/images/thm_introduction_to_cryptography/ry1BfTk26.png" class="img-fluid rounded z-depth-1 bg-white" width="100%" height="auto" title="Diffie-Hellman MITM" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The machanism which allows us to confirm other party identity is Public Key Infrastructure (PKI).</p> <p>PKI is a system which permits the handling of cryptographic keys to securize communications. To do that, entities called Certification Authorities (CA) delivers certificates which link a public key to a specific entity like a webserver. These keys are used to establish secure tunnels with protocols like TLS and the certificates have a period of validity.</p> <p>In order to get signed by a certificate authority, we need to:</p> <ol> <li> <strong>Generate Certificate Signing Request (CSR)</strong>: A certificate containing the public key which have to be signed by CA.</li> <li> <strong>Send CSR to a Certificate Authority (CA)</strong>: The purpose is for the CA to sign your certificate. The alternative and usually insecure solution would be to self-sign the certificate.</li> </ol> <p>The process of signing requires the usage of the private key; because the content is encrypted with a private key, we can ensure the author is the right one by decrypting only by using the correct public key.</p> <p>A CSR can be generated using <code class="language-plaintext highlighter-rouge">openssl</code>:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-new</span> <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:4096 <span class="nt">-keyout</span> key.pem <span class="nt">-out</span> cert.csr
</code></pre></div></div> <p>We can self sign our certificate using the following command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-x509</span> <span class="nt">-newkey</span> <span class="nt">-nodes</span> rsa:4096 <span class="nt">-keyout</span> key.pem <span class="nt">-out</span> cert.pem <span class="nt">-sha256</span> <span class="nt">-days</span> 365
</code></pre></div></div> <p>The certificate can be visualized using the command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl x509 <span class="nt">-in</span> cert.pem <span class="nt">-text</span>
</code></pre></div></div> <h3 id="questions-5">Questions</h3> <p><em>Files located in task06</em></p> <p><strong>What is the size of the public key in bits?</strong></p> <p>Using the command <code class="language-plaintext highlighter-rouge">openssl x509 -in cert.pem -text | more</code>:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: <span class="o">(</span>4096 bit<span class="o">)</span>
</code></pre></div></div> <p><em>Answer: <code class="language-plaintext highlighter-rouge">4096</code></em></p> <p><strong>Till which year is this certificate valid?</strong></p> <p>Using the same command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Validity
            Not Before: Aug 11 11:34:19 2022 GMT
            Not After : Feb 25 11:34:19 2039 GMT
</code></pre></div></div> <p><em>Answer: <code class="language-plaintext highlighter-rouge">2039</code></em></p> <h2 id="task-7---authenticating-with-passwords">Task 7 - Authenticating with Passwords</h2> <p>With PKI and SSL/TLS, we can communicate with the server and provide sensitive information securely. But the data stored on the server should be also secured.</p> <ol> <li>The least secure method: <strong>plaintext</strong> </li> </ol> <p>No effort is required to know the password.</p> <table> <thead> <tr> <th style="text-align: center">Username</th> <th style="text-align: center">Password</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">alice</td> <td style="text-align: center">123</td> </tr> <tr> <td style="text-align: center">bob</td> <td style="text-align: center">156</td> </tr> <tr> <td style="text-align: center">paul</td> <td style="text-align: center">123</td> </tr> </tbody> </table> <ol> <li>A better improvement but not the best: <strong>hashed passwords</strong> </li> </ol> <p>This way, in order to recover the password, an attacker should do a bruteforce/dictionnary attack and potentially get the right hash. The snag is that same passwords have the same hash. This kind of table is called a <strong>rainbow table</strong>.</p> <table> <thead> <tr> <th style="text-align: center">Username</th> <th style="text-align: center">Hash(Password)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">alice</td> <td style="text-align: center">ba1f2511fc30423bdbb183fe33f3dd0f</td> </tr> <tr> <td style="text-align: center">bob</td> <td style="text-align: center">9f430be862c6c636d251b1dddf8f80e6</td> </tr> <tr> <td style="text-align: center">paul</td> <td style="text-align: center">ba1f2511fc30423bdbb183fe33f3dd0f</td> </tr> </tbody> </table> <ol> <li>The best practice: <strong>salted passwords</strong> </li> </ol> <p>A further addition we can make is to add a little random string to the password and hash it. The result is then stored and everytime the <em>Hash(Password + Salt)</em> is calculated. This makes the result always different.</p> <table> <thead> <tr> <th style="text-align: center">Username</th> <th style="text-align: center">Hash(Password + Salt)</th> <th>Salt</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">alice</td> <td style="text-align: center">9e612320ccc0a3485902c0acb1b9845d</td> <td>1111</td> </tr> <tr> <td style="text-align: center">bob</td> <td style="text-align: center">824e30ea2eeb523eeb727110344fa4b3</td> <td>123</td> </tr> <tr> <td style="text-align: center">paul</td> <td style="text-align: center">0a0bcd9c7eeac360f2c31ec7633b99c3</td> <td>1269</td> </tr> </tbody> </table> <p>An improvement to this is to use a key derivation function such as PBKDF2. It takes the password and the salt and submit it through a certain number of iterations.</p> <p>Another approach is to use a slow hashing algorithm; it takes by default, a certain amount of time to calculate the hash of the password + salt.</p> <p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html" rel="external nofollow noopener" target="_blank">Password Storage Sheet Cheat</a></p> <h3 id="questions-6">Questions</h3> <p>Using the website <a href="https://md5decrypt.net/" rel="external nofollow noopener" target="_blank">md5encrypt.net</a>:</p> <p><em>Answer: <code class="language-plaintext highlighter-rouge">qwerty123</code></em></p> <h2 id="task-8---cryptography-and-data---example">Task 8 - Cryptography and Data - Example</h2> <ol> <li> <strong>Certificate Validation:</strong> Cryptography ensures the validity of certificates. A certificate is considered valid if it’s signed. Signing involves encrypting a hash of the certificate with the private key of a trusted third party, and appending the encrypted hash to the certificate.</li> <li> <strong>SSL/TLS Handshake:</strong> Once the certificate is validated, an SSL/TLS handshake begins. This handshake allows the client and server to agree on a secret key and symmetric encryption algorithm for secure communication.</li> <li> <strong>Symmetric Encryption:</strong> After the handshake, all session communication is encrypted using symmetric encryption, using the agreed-upon secret key.</li> <li> <strong>Login Credentials:</strong> The client sends login credentials securely over the encrypted SSL/TLS session. The server receives the credentials and verifies them.</li> <li> <strong>Password Storage:</strong> Following security best practices, the server hashes the password, appending a random salt to make it difficult to recover in case of a database breach.</li> </ol> <h2 id="task-9---conclusion">Task 9 - Conclusion</h2> <p>Cryptography is a vast topic. In this room, we tried to focus on the core concepts that would help you understand the commonly used terms in cryptography. This knowledge is vital to understanding the configuration options of systems that use encryption and hashing.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/THM-Security-Principles/">THM Security Principles</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/THM-Security-Engineer-Intro/">THM Security Engineer Intro</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/THM-CTF-Blog/">THM CTF Blog</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/THM-CTF-Investigating-Windows/">THM CTF Investigating Windows</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/THM-CTF-Wonderland/">THM CTF Wonderland</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 NonoHM . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>